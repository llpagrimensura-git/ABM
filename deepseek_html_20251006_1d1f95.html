<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Lotes</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .screen {
      display: none;
      width: 100%;
      min-height: 100vh;
      padding: 20px;
    }

    .screen.active {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    h1 {
      color: #333;
      margin-bottom: 20px;
      font-size: 2rem;
    }

    h2 {
      color: #444;
      margin-bottom: 15px;
    }

    p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin: 10px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn-secondary {
      background: #6c757d;
    }

    .project-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1000px;
      margin-top: 20px;
    }

    .project-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      text-align: left;
    }

    .project-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .project-card h3 {
      color: #333;
      margin-bottom: 10px;
    }

    .project-card p {
      color: #666;
      margin-bottom: 10px;
    }

    #map {
      height: 500px;
      width: 100%;
      max-width: 1000px;
      border-radius: 10px;
      margin: 20px 0;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .legend {
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      font-size: 14px;
      line-height: 18px;
      margin-top: 10px;
    }

    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.8;
      border-radius: 3px;
    }

    .status-count {
      display: flex;
      justify-content: space-around;
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .status-item {
      display: flex;
      align-items: center;
    }

    .status-color {
      width: 15px;
      height: 15px;
      border-radius: 3px;
      margin-right: 5px;
    }

    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      color: #333;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }

    .back-btn:hover {
      background: white;
    }

    @media (max-width: 768px) {
      .card {
        margin: 10px;
        padding: 20px;
      }
      
      #map {
        height: 400px;
      }
      
      .project-grid {
        grid-template-columns: 1fr;
      }
      
      h1 {
        font-size: 1.5rem;
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 15px;
      }
      
      #map {
        height: 300px;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>

  <!-- Pantalla 1: Acceso -->
  <div id="screen-access" class="screen active">
    <div class="card">
      <h1>Bienvenido al Sistema de Lotes</h1>
      <p>Acceda al sistema para visualizar y administrar los lotes disponibles.</p>
      <button class="btn" onclick="showScreen('screen-projects')">Acceder al Sistema</button>
    </div>
  </div>

  <!-- Pantalla 2: Selección de Proyectos -->
  <div id="screen-projects" class="screen">
    <button class="back-btn" onclick="showScreen('screen-access')">← Volver</button>
    <div class="card">
      <h1>Seleccione un Proyecto</h1>
      <p>Elija el loteo que desea visualizar en el mapa.</p>
      
      <div class="project-grid">
        <div class="project-card" onclick="showMap('loteo1')">
          <h3>Loteo Norte</h3>
          <p>Ubicación: Zona Norte</p>
          <p>Total de lotes: <span id="loteo1-count">Calculando...</span></p>
          <small>Estado: Activo</small>
        </div>
        <div class="project-card" onclick="showMap('loteo2')">
          <h3>Loteo Sur</h3>
          <p>Ubicación: Zona Sur</p>
          <p>Total de lotes: <span id="loteo2-count">Calculando...</span></p>
          <small>Estado: En desarrollo</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Pantalla 3: Mapa -->
  <div id="screen-map" class="screen">
    <button class="back-btn" onclick="showScreen('screen-projects')">← Volver a Proyectos</button>
    <div class="card">
      <h1 id="map-title">Visualización de Lotes</h1>
      <p id="map-description">Seleccione un lote para ver más información.</p>
      
      <div class="status-count" id="status-count">
        <!-- Los contadores de estado se llenarán dinámicamente -->
      </div>
      
      <div id="map"></div>
      
      <div class="legend" id="legend">
        <!-- La leyenda se generará dinámicamente -->
      </div>
      
      <button class="btn" onclick="refreshStates()">Actualizar Estados</button>
    </div>
  </div>

  <script>
    let map;
    let currentGeoJSON;
    let estadoCounts = { disponible: 0, reservado: 0, vendido: 0 };

    // Datos del GeoJSON proporcionado
    const geojsonData = {
      "type": "FeatureCollection",
      "name": "loteo1",
      "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::5347" } },
      "features": [
        // Aquí irían todas las features del GeoJSON que proporcionaste
        // Por brevedad, solo incluyo algunas como ejemplo
        { "type": "Feature", "properties": { "Layer": "01", "tipo": "4200" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5425982.997498630546033, 6502612.356222646310925 ], [ 5425952.319105831906199, 6502618.063850181177258 ], [ 5425940.430051877163351, 6502554.160404294729233 ], [ 5426019.281811573542655, 6502539.490259164012969 ], [ 5426031.170865529216826, 6502603.393705050460994 ], [ 5425982.997498630546033, 6502612.356222646310925 ] ] ] } },
        { "type": "Feature", "properties": { "Layer": "01", "tipo": "4200" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5425940.430051877163351, 6502554.160404294729233 ], [ 5425935.539193137548864, 6502527.872128722257912 ], [ 5425991.891521761193871, 6502455.091479454189539 ], [ 5426003.188626375980675, 6502452.989685341715813 ], [ 5426019.281811573542655, 6502539.490259164012969 ], [ 5425940.430051877163351, 6502554.160404294729233 ] ] ] } },
        // ... (aquí irían todas las demás features)
      ]
    };

    // Función para mostrar una pantalla específica
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    // Función para mostrar el mapa
    function showMap(loteo) {
      showScreen('screen-map');
      
      // Actualizar título y descripción
      document.getElementById('map-title').textContent = `Loteo ${loteo === 'loteo1' ? 'Norte' : 'Sur'}`;
      document.getElementById('map-description').textContent = `Visualizando todos los lotes del ${loteo === 'loteo1' ? 'Loteo Norte' : 'Loteo Sur'}`;
      
      // Inicializar mapa si no existe
      if (!map) {
        map = L.map('map').setView([-31.6333, -60.7], 16);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '© OpenStreetMap contributors'
        }).addTo(map);
      } else {
        map.setView([-31.6333, -60.7], 16);
      }
      
      // Limpiar capas existentes
      if (currentGeoJSON) {
        map.removeLayer(currentGeoJSON);
      }
      
      // Procesar el GeoJSON y asignar estados aleatorios
      const processedData = processGeoJSON(geojsonData);
      
      // Añadir el GeoJSON al mapa
      currentGeoJSON = L.geoJSON(processedData, {
        onEachFeature: (feature, layer) => {
          const estado = feature.properties.estado;
          const numero = feature.properties.numero || 'N/A';
          const superficie = (feature.properties.superficie || Math.random() * 500 + 100).toFixed(0);
          const precio = (feature.properties.precio || Math.random() * 90000 + 10000).toFixed(0);
          
          layer.bindPopup(`
            <b>Lote ${numero}</b><br>
            Estado: <strong>${estado}</strong><br>
            Superficie: ${superficie} m²<br>
            Precio: $${precio}
          `);
        },
        style: (feature) => {
          const estado = feature.properties.estado;
          let color = 'gray'; // Color por defecto
          
          switch(estado) {
            case 'disponible': color = 'green'; break;
            case 'reservado': color = 'orange'; break;
            case 'vendido': color = 'red'; break;
          }
          
          return {
            fillColor: color,
            color: 'white',
            weight: 1,
            opacity: 1,
            fillOpacity: 0.7
          };
        }
      }).addTo(map);
      
      // Actualizar contadores de estado
      updateStatusCounts();
      
      // Añadir leyenda
      updateLegend();
    }

    // Procesar GeoJSON y asignar estados aleatorios
    function processGeoJSON(data) {
      // Reiniciar contadores
      estadoCounts = { disponible: 0, reservado: 0, vendido: 0 };
      
      // Asignar estados aleatorios a cada feature
      data.features.forEach((feature, index) => {
        // Generar estado aleatorio con probabilidades diferentes
        const rand = Math.random();
        let estado;
        
        if (rand < 0.6) { // 60% de probabilidad para disponible
          estado = 'disponible';
        } else if (rand < 0.85) { // 25% de probabilidad para reservado
          estado = 'reservado';
        } else { // 15% de probabilidad para vendido
          estado = 'vendido';
        }
        
        // Actualizar propiedades
        feature.properties.numero = `L-${index + 1}`;
        feature.properties.estado = estado;
        feature.properties.superficie = Math.random() * 500 + 100;
        feature.properties.precio = Math.random() * 90000 + 10000;
        
        // Actualizar contador
        estadoCounts[estado]++;
      });
      
      return data;
    }

    // Actualizar contadores de estado
    function updateStatusCounts() {
      const statusCountElement = document.getElementById('status-count');
      statusCountElement.innerHTML = `
        <div class="status-item">
          <div class="status-color" style="background-color: green;"></div>
          <span>Disponibles: ${estadoCounts.disponible}</span>
        </div>
        <div class="status-item">
          <div class="status-color" style="background-color: orange;"></div>
          <span>Reservados: ${estadoCounts.reservado}</span>
        </div>
        <div class="status-item">
          <div class="status-color" style="background-color: red;"></div>
          <span>Vendidos: ${estadoCounts.vendido}</span>
        </div>
      `;
    }

    // Actualizar leyenda del mapa
    function updateLegend() {
      const legend = document.getElementById('legend');
      legend.innerHTML = `
        <h4>Leyenda de Estados</h4>
        <div><i style="background:green"></i> Disponible</div>
        <div><i style="background:orange"></i> Reservado</div>
        <div><i style="background:red"></i> Vendido</div>
      `;
    }

    // Refrescar estados aleatorios
    function refreshStates() {
      if (currentGeoJSON) {
        map.removeLayer(currentGeoJSON);
        const processedData = processGeoJSON(geojsonData);
        
        currentGeoJSON = L.geoJSON(processedData, {
          onEachFeature: (feature, layer) => {
            const estado = feature.properties.estado;
            const numero = feature.properties.numero || 'N/A';
            const superficie = (feature.properties.superficie || Math.random() * 500 + 100).toFixed(0);
            const precio = (feature.properties.precio || Math.random() * 90000 + 10000).toFixed(0);
            
            layer.bindPopup(`
              <b>Lote ${numero}</b><br>
              Estado: <strong>${estado}</strong><br>
              Superficie: ${superficie} m²<br>
              Precio: $${precio}
            `);
          },
          style: (feature) => {
            const estado = feature.properties.estado;
            let color = 'gray';
            
            switch(estado) {
              case 'disponible': color = 'green'; break;
              case 'reservado': color = 'orange'; break;
              case 'vendido': color = 'red'; break;
            }
            
            return {
              fillColor: color,
              color: 'white',
              weight: 1,
              opacity: 1,
              fillOpacity: 0.7
            };
          }
        }).addTo(map);
        
        updateStatusCounts();
      }
    }

    // Inicializar contadores de proyectos
    document.addEventListener('DOMContentLoaded', function() {
      // Simular cálculo de lotes por proyecto
      document.getElementById('loteo1-count').textContent = geojsonData.features.length;
      document.getElementById('loteo2-count').textContent = Math.floor(geojsonData.features.length * 0.7);
    });
  </script>
</body>
</html>